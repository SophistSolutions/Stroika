include ../Configuration.mk
include	../SharedMakeVariables.mk
include	../SharedBuildRules.mk

RelPathToStroikaDevRoot	=	../../../../../
SrcDir					=	$(RelPathToStroikaDevRoot)Library/Sources/Stroika/Foundation/


VPATH		=	$(SrcDir) $(StroikaLibDir)

SubDirs=				\
	Cache				\
	Characters			\
	Common				\
	Configuration		\
	Containers			\
	Cryptography		\
	Database			\
	DataExchangeFormat	\
	Debug				\
	Execution			\
	IO					\
	Linguistics			\
	Math				\
	Memory				\
	Streams				\
	Time				\
	Traversal			\


ALL_OBJS := $(foreach dir, $(SubDirs), $(addprefix "./$(dir)/", $(shell make --directory $(dir) -s list-objs)))


all-objs:
	@echo $(ALL_OBJS)


$(ALL_OBJS):
	@for i in $(SubDirs);\
	do\
	    $(MAKE) --directory $$i -s all;\
	done

$(StroikaFoundationLib):	$(ALL_OBJS)
	@mkdir -p $(StroikaLibDir)
	@echo Creating $(StroikaFoundationLib)...
	@rm -f $(StroikaFoundationLib)
	@$(AR) cq $(StroikaFoundationLib) $(ALL_OBJS)
	#@for i in $(SubDirs);\
	#do\
	#    (for oo in `$(MAKE) --directory $$i -s list-objs`; do ($(AR) cq $(StroikaFoundationLib) $$i/$$oo); done )\
	#done
	@$(RANLIB) $(StroikaFrameworksLib)


all:	$(StroikaFoundationLib)


clean::
	@for i in $(SubDirs);\
	do\
	    $(MAKE) --directory $$i -s clean;\
	done


clobber::
	@rm -f $(StroikaFoundationLib)


Build:	all


