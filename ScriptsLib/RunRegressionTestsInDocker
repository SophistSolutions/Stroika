#!/bin/bash

StroikaRoot=~/Sandbox/Stroika-Dev
CONTAINER_NAME="${CONTAINER_NAME:-regression-tests}"
EXTRA_DNS="${EXTRA_DNS:-192.168.244.1}"

### Can set CMD2RUN=./ScriptsLib/RegressionTests.sh
CMD2RUN="${CMD2RUN:-bash}"

docker stop ${CONTAINER_NAME} || true
docker rm ${CONTAINER_NAME} || true

docker run \
	-u`id -u`:`id -g` -v /etc/passwd:/etc/passwd:ro -v /etc/group:/etc/group:ro \
	--dns ${EXTRA_DNS} \
	--dns 8.8.8.8 \
	--security-opt seccomp=unconfined \
	-it\
	 -e COLUMNS=\"`tput cols`\" -e LINES=\"`tput lines`\" \
	--name ${CONTAINER_NAME} \
	-h ${CONTAINER_NAME} \
	-v $StroikaRoot:/Sandbox-StroikaRoot \
	-w /Sandbox-StroikaRoot \
	sophistsolutionsinc/stroika-buildvm-ubuntu1804-regression-tests \
	${CMD2RUN}
