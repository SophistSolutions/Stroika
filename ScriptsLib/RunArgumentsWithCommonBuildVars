#!/usr/bin/env perl

#
# e.g.
#		RunArgumentsWithCommonBuildVars Debug-U-32 make -k foo
#
#	First arg is configuration. The remaining args all passed along to the next command
#
#	On windows (Visual Studio), this creates a .bat file, runs vcvarsall.bat (right arch), and then puts the arguments
#	to this script into that .bat file, and runs the full .bat file
#

use File::Temp qw(tempfile);

BEGIN{ @INC = ( "./", @INC ); }

sub	GetThisScriptDir {
	use File::Basename;
	use Cwd 'abs_path';
	my $p = __FILE__;
	my $A = abs_path ($p);
	my $dirname = dirname($A);
	return $dirname;
}
my	$thisScriptDir	=	GetThisScriptDir ();

my $activeConfig = $ARGV[0];
my $l = @ARGV-1;
my $cmd = (join " ", @ARGV[1..$l]);

require "$thisScriptDir/ConfigurationReader.pl";

my $useProjectDir= "$thisScriptDir/../Library/Projects/" . GetProjectPlatformSubdirIfAny ($activeConfig);
if (-e "$useProjectDir/SetupBuildCommonVars.pl") {
	require "$useProjectDir/SetupBuildCommonVars.pl";
}

my $result = RunSystemWithVCVarsSetInEnvironment (GetConfigurationParameter($activeConfig, "ARCH"), $cmd);
# exit int ($result) doesn't work - for reasons I don't understand, but since I intend to abaondo use of perl, no point in debugging - just workaround for now --LGP 2017-10-29
if ($result == 0) {
	exit 0;
}
else {
	exit 1;
}
