#
# This optional component may be used on windows to build windows installers (MSI files)
#
export StroikaRoot?=$(shell realpath ../..)/

include $(StroikaRoot)ScriptsLib/Makefile-Common.mk

VERSION=311
FOLDERNAMEVER=wix$(VERSION)1rtm
FILEVERNAME=wix$(VERSION)-binaries

ZIPEDFILE=../Origs-Cache/$(FILEVERNAME).zip


FETCHURLS=
FETCHURLS+=https://github.com/wixtoolset/wix3/releases/download/$(FOLDERNAMEVER)/$(FILEVERNAME).zip


PRODUCED_OUTPUT_ARTIFACTS=	\
	CURRENT/candle.exe		\


all:	
	@../../ScriptsLib/PrintProgressLine.sh $(MAKE_INDENT_LEVEL) "Stroika/ThirdPartyComponents/WIX Build $(VERSION) {$(CONFIGURATION)}:"
	@../../ScriptsLib/CheckValidConfiguration.sh $(CONFIGURATION)
	@$(MAKE) --silent CURRENT
	@$(MAKE) --no-print-directory MAKE_INDENT_LEVEL=$$(($(MAKE_INDENT_LEVEL)+1)) check

clean:

clobber:
	@rm -rf CURRENT

$(ZIPEDFILE):
	@MAKE_INDENT_LEVEL=$$(($(MAKE_INDENT_LEVEL)+1)) ../../ScriptsLib/WebGet.sh $(ZIPEDFILE) $(FETCHURLS)

CURRENT:	$(ZIPEDFILE)
	@unzip -q $(ZIPEDFILE) -d CURRENT
	@/bin/find CURRENT -name \*.exe -exec chmod +x {} \;

check-prerequisite-tools:
	@../../ScriptsLib/PrintProgressLine.sh $(MAKE_INDENT_LEVEL) -n "Checking Prerequisite tools for sqlite ... "
	@{ type unzip > /dev/null; } || { ../../ScriptsLib/PrintProgressLine.sh $(MAKE_INDENT_LEVEL) "Checking required build tools ... " && ../../ScriptsLib/GetMessageForMissingTool.sh unzip && exit 1; }
	@$(ECHO) "done";

check:
	@../../ScriptsLib/PrintProgressLine.sh $(MAKE_INDENT_LEVEL) -n "Checking ... "
	@for i in $(PRODUCED_OUTPUT_ARTIFACTS) ; do \
		if [ ! -e $$i ]; then\
			$(ECHO) "   FAILED: missing $$i";\
			exit 1;\
		fi;\
	done
	@$(ECHO) " Stroika/ThirdPartyComponents/WIX -  [Succeeded]";
